\documentclass[../report.tex]{subfiles}

\begin{document}
\section{Error handling}
In a WCF service exceptions are serialized to XML and passed to the client in a SOAP message. If a CLR\footnote{Common Language Runtime - the virtual machine component of Microsoft's .NET framework} exception is passed to a non-.NET client, it is very likely to fail as there is no guarantee that the exception exists in different platforms. As we are not interested in either limiting our clients to .NET implementations nor only using undeclared SOAP faults, we decided to use custom SOAP faults. 

We have solved this by defining fault data contracts and then marking which SOAP faults each operation throws so that they are exposed to clients in WSDL. An example of such a data contract is the UnauthorizedClient which is thrown when the client is not recognized by the system and looks like this:

\begin{figure}[H]
\begin{lstlisting}[frame=single]
    [DataContract]
    public class UnauthorizedClient
    {
        [DataMember]
        public string Message { get; set; }
    }
\end{lstlisting}
\caption{UnauthorizedClient fault data contract}
\end{figure}

We have defined the following fault data contracts:

\begin{itemize}
\item AccessRightNotFound
\item ArgumentFault
\item MediaItemNotFound
\item ObjectNotFound
\item UnauthorizedClient
\item UnauthorizedUser
\end{itemize}

This solution allows us to catch a CLR exception and throw our custom SOAP fault data contract which is interoperable with non-.NET implementations instead. The following code snippet is from a catch-block:

\begin{figure}[H]
\begin{lstlisting}[frame=single]
    var fault = new UnauthorizedClient();
    fault.Message = "The Client is not authorized to perform this request.";
    throw new FaultException<UnauthorizedClient>(fault, 
        new FaultReason(fault.Message));
\end{lstlisting}
\caption{Example body of catch-block}
\end{figure}

This decision was mainly made because we initially expected the SMU students to write their client in Javascript and HTML5. We later found that they decided to go with a .NET client and therefore this decision was somewhat unnecessary. 

\end{document}