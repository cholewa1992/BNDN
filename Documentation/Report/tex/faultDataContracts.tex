\documentclass[../report.tex]{subfiles}

\begin{document}
\subsection{Exposing errors}
In a WCF service, exceptions are serialized to XML and passed to the \textit{Client} in a SOAP message. If a CLR\footnote{Common Language Runtime - the virtual machine component of Microsoft's .NET framework} exception is passed to a non-.NET \textit{Client}, it is very likely to fail, as there is no guarantee that the exception exists in different platforms. Since neither limiting \textit{Client}s to .NET implementations nor only using undeclared SOAP faults were desired, it was decided to use custom SOAP faults.

The above mentioned issue was solved by defining fault contracts and then marking which SOAP faults each operation throws, so that they are exposed to \textit{Client}s in WSDL. An example of such a data contract is the UnauthorizedClient. This is thrown when a client is not recognized by the system. The following shows the implementation of the UnauthorizedClient fault data contract:


\begin{figure}[H]
\begin{lstlisting}[frame=tb]
    [DataContract]
    public class UnauthorizedClient
    {
        [DataMember]
        public string Message { get; set; }
    }
\end{lstlisting}
\caption{UnauthorizedClient fault data contract}
\end{figure}

%The following data contracts have been defined in the system:

%\begin{itemize}
%\item AccessRightNotFound
%\item ArgumentFault
%\item MediaItemNotFound
%\item ObjectNotFound
%\item UnauthorizedClient
%\item UnauthorizedUser
%\end{itemize}

The solution allows one to catch a CLR exception and instead throw the custom SOAP fault data contract which is interoperable with non-.NET implementations. The following code snippet is an example of a catch-block where the custom CLR exception is caught and transformed into a custom SOAP fault:

\begin{figure}[H]
\begin{lstlisting}[frame=tb]
    var fault = new UnauthorizedClient();
    fault.Message = "The Client is not authorized to perform this request.";
    throw new FaultException<UnauthorizedClient>(fault, 
        new FaultReason(fault.Message));
\end{lstlisting}
\caption{Example body of catch-block}
\end{figure}

This decision of having custom SOAP faults was mainly because the SMU students initially were to write their \textit{Client} in Javascript and HTML5. However, the students from SMU decided to go with a .NET \textit{Client} and therefore this decision seems somewhat unnecessary. 

\end{document}